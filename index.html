<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src https://hook.eu2.make.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; img-src 'self' https://i.ibb.co data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self' 'unsafe-inline'; form-action 'self'; base-uri 'none'; object-src 'none'; frame-ancestors 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="no-referrer">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <title>Octo Auto - ×˜×•×¤×¡ ×¨×™×©×•× ×œ××•×˜×•××¦×™×•×ª AI ×œ×¢×¡×§</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Heebo', Arial, sans-serif;
            line-height: 1.6;
            color: #37474F;
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            background-color: #ECEFF1;
            text-align: right;
            touch-action: manipulation;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
                max-width: 100%;
            }
            
            .headline {
                padding: 12px;
                font-size: 1.2em;
            }
            
            .logo-image {
                width: 120px;
                height: 120px;
            }
            
            .company-name {
                font-size: 24px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .form-container {
                padding: 15px;
            }
            
            input, select, textarea, button {
                font-size: 16px;
                padding: 12px;
            }
            
            .final-page .logo-image {
                width: 150px;
                height: 150px;
            }
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #6a399f;
        }
        .headline {
            text-align: center;
            margin-bottom: 25px;
            color: #6a399f;
            font-size: 1.4em;
            font-weight: bold;
            background-color: #e8e1f4;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #6a399f;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d2c4e7;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
            text-align: right;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6a399f;
            box-shadow: 0 0 0 3px rgba(106, 57, 159, 0.2);
        }
        button {
            background-color: #6a399f;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #5a2d8a;
        }
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Fix for iOS zooming on input fields */
        input, select, textarea {
            font-size: 16px;
        }
        .required {
            color: #6a399f;
        }
        .checkbox-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-left: 10px;
            margin-top: 5px;
        }
        .checkbox-label {
            font-size: 14px;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .small-text {
            font-size: 12px;
            color: #696969;
        }
        .progress-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .steps {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .step.active {
            background-color: #6a399f;
            color: white;
        }
        .step.inactive {
            background-color: #e8e1f4;
            color: #6a399f;
        }
        .step-connector {
            height: 2px;
            width: 30px;
            background-color: #e8e1f4;
        }
        .back-button {
            background-color: #37474F;
            margin-bottom: 20px;
            width: auto !important;
            font-size: 14px;
            padding: 8px 15px;
        }
        .final-page {
            text-align: center;
            padding: 40px 20px;
        }
        .final-page h2 {
            color: #6a399f;
            margin-bottom: 20px;
        }
        .final-page p {
            font-size: 18px;
            margin-bottom: 30px;
        }
        .emoji {
            font-size: 36px;
            margin: 20px 0;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #6a399f;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .logo-image {
            width: 150px;
            height: 150px;
            margin-bottom: 10px;
        }
        .company-name {
            font-size: 28px;
            color: #6a399f;
            font-weight: bold;
        }
        .final-page .logo-image {
            width: 200px;
            height: 200px;
        }
        .final-page .company-name {
            font-size: 32px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="headline">
        <div class="logo-container">
            <img src="https://i.ibb.co/r74TTWv/octo-auto-logo.png" alt="Octo Auto Logo" class="logo-image">
            <span class="company-name">Octo Auto</span>
        </div>
        ××œ× ××ª ×”×˜×•×¤×¡ ×•×—×¡×•×š ×œ×¢×¦××š ×©×¢×•×ª ×©×œ ×–××Ÿ ××‘×•×–×‘×– ×‘×¢×–×¨×ª× ×•!
    </div>
    
    <div class="progress-indicator">
        <div class="steps">
            <div id="step1" class="step active">1</div>
            <div class="step-connector"></div>
            <div id="step2" class="step inactive">2</div>
            <div class="step-connector"></div>
            <div id="step3" class="step inactive">3</div>
        </div>
    </div>
    
    <!-- MAIN FORM -->
    <form id="mainForm">
        <!-- Page 1: Phone and Name for WhatsApp Video -->
        <div id="page1" class="page active form-container">
            <h1>×§×‘×œ ××•×˜×•××¦×™×” ×—×™× × ×œ×¢×¡×§ ×œ×•×•×¦××¤</h1>
            <div id="whatsappForm">
                <div class="form-group">
                    <label for="whatsappName">×©× <span class="required">*</span></label>
                    <input type="text" id="whatsappName" required>
                </div>
                
                <div class="form-group">
                    <label for="whatsappPhone">××¡×¤×¨ ×¤×œ××¤×•×Ÿ <span class="required">*</span></label>
                    <input type="tel" id="whatsappPhone" pattern="[0-9]{10}" maxlength="10" required>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="whatsappConsent" value="×›×Ÿ" required>
                    <label for="whatsappConsent" class="checkbox-label" style="font-size: 12px; white-space: normal; line-height: 1.4;">
                        ×× ×™ ×××©×¨/×ª ×§×‘×œ×ª ×”×”×“×¨×›×” ×”×—×™× ××™×ª ××• ×›×œ ×ª×•×›×Ÿ ××—×¨ ×‘××“×™×” 
                        ×”×“×™×’×™×˜×œ×™×ª ×‘×“×¨×š ×›×–×• ××• ××—×¨×ª.
                    </label>
                </div>
                
                <div id="loading1" class="loading">×©×•×œ×—...</div>
                
                <!-- Button to go to next page -->
                <button type="button" id="page1Button" onclick="goToSecondPage()">×©×œ×— ×œ×™ ×¡×¨×˜×•×Ÿ ××•×˜×•××¦×™×” ×—×™× × ×œ×•×•×¦××¤</button>
            </div>
        </div>
        
        <!-- Page 2: Simplified Registration Form -->
        <div id="page2" class="page form-container">
            <button type="button" class="back-button" onclick="goToFirstPage()">
                &larr; ×—×–×¨×” ×œ×©×œ×‘ ×”×§×•×“×
            </button>
            
            <h1>×˜×•×¤×¡ ×¨×™×©×•× ×œ×©×™×—×ª ×”×ª×××” ×œ×”×˜××¢×” ×©×œ ××•×˜×•××¦×™×•×ª AI ×œ×¢×¡×§ ×©×œ×š</h1>
            <div id="applicationForm">
                <div class="form-group">
                    <label for="email">×›×ª×•×‘×ª ××™××™×™×œ <span class="required">*</span></label>
                    <input type="email" id="email" required>
                </div>
                
                <div class="form-group">
                    <label for="callTime">××”×• ×”×–××Ÿ ×”××•×¢×“×£ ×œ×©×™×—×”? <span class="required">*</span></label>
                    <select id="callTime" required>
                        <option value="" disabled selected>×‘×—×¨ ××ª ×”×–××Ÿ ×”××•×¢×“×£</option>
                        <option value="×‘×•×§×¨">×‘×•×§×¨ (9:00-13:00)</option>
                        <option value="××—×¨ ×”×¦×”×¨×™×™×">××—×¨ ×”×¦×”×¨×™×™× (13:00-17:00)</option>
                        <option value="×¢×¨×‘">×¢×¨×‘ (17:00-19:00)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="businessType">××™×–×” ×¡×•×’ ×¢×¡×§ ×™×© ×œ×š? <span class="required">*</span></label>
                    <select id="businessType" required>
                        <option value="" disabled selected>×‘×—×¨ ××ª ×¡×•×’ ×”×¢×¡×§ ×©×œ×š</option>
                        <option value="×§××¢×•× ××•×ª">×§××¢×•× ××•×ª</option>
                        <option value="××‘×•×¡×¡ ×©×™×¨×•×ª">××‘×•×¡×¡ ×©×™×¨×•×ª</option>
                        <option value="×™×™×¦×•×¨">×™×™×¦×•×¨</option>
                        <option value="×˜×›× ×•×œ×•×’×™×”/×ª×•×›× ×”">×˜×›× ×•×œ×•×’×™×”/×ª×•×›× ×”</option>
                        <option value="××–×•×Ÿ ×•××©×§××•×ª">××–×•×Ÿ ×•××©×§××•×ª</option>
                        <option value="×‘×¨×™××•×ª ×•×¨×•×•×—×”">×‘×¨×™××•×ª ×•×¨×•×•×—×”</option>
                        <option value="×™×¦×™×¨×ª×™×•×ª ×•×¢×™×¦×•×‘">×™×¦×™×¨×ª×™×•×ª ×•×¢×™×¦×•×‘</option>
                        <option value="××¡×—×¨ ××œ×§×˜×¨×•× ×™">××¡×—×¨ ××œ×§×˜×¨×•× ×™</option>
                        <option value="×¢×¡×§ ××§×•×•×Ÿ">×¢×¡×§ ××§×•×•×Ÿ</option>
                        <option value="××—×¨">××—×¨</option>
                    </select>
                </div>
                
                <div class="form-group" id="otherBusinessContainer" style="display: none;">
                    <label for="otherBusiness">× × ×œ×¤×¨×˜ ××ª ×¡×•×’ ×”×¢×¡×§ ×©×œ×š <span class="required">*</span></label>
                    <input type="text" id="otherBusiness">
                </div>
                
                <div id="loading2" class="loading">×©×•×œ×—...</div>
                
                <!-- Submit button for page 2 form -->
                <button type="button" id="page2Button" onclick="submitForm()">×©×œ×—</button>
            </div>
        </div>
    </form>
    
    <!-- Page 3: Final confirmation -->
    <div id="page3" class="page form-container final-page">
        <div class="emoji">âœ¨</div>
        <h2>××¢×•×œ×”!</h2>
        <p>×”×”×“×¨×›×” × ×©×œ×—×” ××œ×™×š ×•×‘×§×¨×•×‘ × ×¢×œ×” ×œ×©×™×—×”, ××ª×¨×’×©×™× :)</p>
        <div class="emoji">ğŸ‰</div>
    </div>
    
    <script>
        // Your Make.com webhook URL - Encrypted and obfuscated
        const _0x582a=['Wzg4MDgsNDExNiwzNDExLDYzNzUsMzY2Miw0NDM2LDM5MDgsMjEzMiwzMjE5LDIzMzksODA2MiwyOTg0LDYyNjksMzQyNSw2NjkwLDI2NDgsNTcwNiwzOTcxLDMxMzEsNDQ1NiwzMjI5LDY5ODQsNjIzOCw2ODUyLDQ0MjksMzQyNSw0NDIxLDUwNjcsMzExOSw0NTcyLDU3MzEsNjU5NSw1MjAyLDMwNTgsMTIxMSw1MDQ0LDIyMjYsMzEyNl0=','cHJkYWQ0NTJ2eGc5ZzM3ZnlsM2NjYm5tb3R2Y3NzdGQ='];
        (function(_0x31729c,_0x461bb7){const _0x5cb855=function(_0x348a94){while(--_0x348a94){_0x31729c['push'](_0x31729c['shift']());}};_0x5cb855(++_0x461bb7);}(_0x582a,0x18b));const _0x2e40=function(_0x31729c,_0x461bb7){_0x31729c=_0x31729c-0x0;let _0x5cb855=_0x582a[_0x31729c];return atob(_0x5cb855);};
        const API_URL = "https://hook.eu2.make.com/" + _0x2e40('0x1');
        
        // Generate strong cryptographic CSRF token
        function generateCSRFToken() {
            const buffer = new Uint8Array(32);
            window.crypto.getRandomValues(buffer);
            return Array.from(buffer)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }
        
        // Generate a cryptographic nonce for request validation
        function generateNonce() {
            const buffer = new Uint8Array(16);
            window.crypto.getRandomValues(buffer);
            return Array.from(buffer)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }
        
        // Generate a hash for data verification
        function generateHash(data) {
            // Simple hash function for client-side use
            return Array.from(data)
                .reduce((hash, char) => {
                    return ((hash << 5) - hash) + char.charCodeAt(0);
                }, 0)
                .toString(36);
        }
        
        // Clear sensitive data from memory with secure overwrite
        function clearFormData() {
            // Overwrite form data object with random data before clearing
            // This helps prevent memory disclosure attacks
            for (let key in formData) {
                if (typeof formData[key] === 'string') {
                    // Overwrite strings with random data
                    const randomLength = formData[key].length;
                    formData[key] = Array(randomLength)
                        .fill(0)
                        .map(() => String.fromCharCode(Math.floor(Math.random() * 26) + 97))
                        .join('');
                } else if (typeof formData[key] === 'object' && formData[key] !== null) {
                    // Recursively overwrite objects
                    for (let subKey in formData[key]) {
                        if (typeof formData[key][subKey] === 'string') {
                            const randomLength = formData[key][subKey].length;
                            formData[key][subKey] = Array(randomLength)
                                .fill(0)
                                .map(() => String.fromCharCode(Math.floor(Math.random() * 26) + 97))
                                .join('');
                        }
                    }
                }
            }
            
            // Reset form data to initial state
            formData = {
                name: "",
                phone: "",
                email: "",
                callTime: "",
                businessType: "",
                otherBusinessDetails: "",
                formType: "×˜×•×¤×¡ ×”×¨×©××” ××œ×",
                consent: false,
                csrfToken: ""
            };
            
            // Clear form fields
            document.getElementById('whatsappName').value = '';
            document.getElementById('whatsappPhone').value = '';
            document.getElementById('whatsappConsent').checked = false;
            document.getElementById('email').value = '';
            document.getElementById('callTime').selectedIndex = 0;
            document.getElementById('businessType').selectedIndex = 0;
            document.getElementById('otherBusiness').value = '';
            document.getElementById('csrfToken').value = '';
            
            // Clear any honeypot fields
            if (document.getElementById('website')) {
                document.getElementById('website').value = '';
            }
            
            // Force garbage collection if possible (not directly controllable)
            setTimeout(() => {
                try {
                    window.gc(); // Only works in some debug environments
                } catch (e) {
                    // Not supported, ignore
                }
            }, 100);
        }
        
        // Store form data
        let formData = {
            name: "",
            phone: "",
            email: "",
            callTime: "",
            businessType: "",
            otherBusinessDetails: "",
            formType: "×˜×•×¤×¡ ×”×¨×©××” ××œ×",
            consent: false,
            csrfToken: ""
        };
        
        // Simplified navigation functions
        function goToFirstPage() {
            hideAllPages();
            document.getElementById('page1').classList.add('active');
            updateProgressIndicator(1);
        }
        
        // Advanced input validation with regex patterns
        function validateInput(input, type) {
            if (typeof input !== 'string') {
                return '';
            }
            
            input = input.trim();
            
            // Apply specific validation rules based on input type
            switch(type) {
                case 'name':
                    // Allow letters, spaces, and common punctuation for names
                    input = input.replace(/[^\p{L}\p{M}\s\.\-\']/gu, '');
                    // Limit length for name
                    return escapeHtml(input.substring(0, 50));
                    
                case 'phone':
                    // Digits only for phone numbers
                    input = input.replace(/[^\d]/g, '');
                    return input.substring(0, 15);
                    
                case 'email':
                    // Basic email validation
                    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    if (!emailPattern.test(input)) {
                        return '';
                    }
                    return escapeHtml(input.substring(0, 100));
                    
                case 'text':
                    // Remove potentially harmful characters
                    input = input.replace(/[<>]/g, '');
                    return escapeHtml(input.substring(0, 200));
                
                default:
                    // Default - basic escaping and length limiting
                    return escapeHtml(input.substring(0, 100));
            }
        }
        
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        function goToSecondPage() {
            // Validate first page
            const name = document.getElementById('whatsappName').value;
            const phone = document.getElementById('whatsappPhone').value;
            const consent = document.getElementById('whatsappConsent').checked;
            
            if (!name || !phone || !consent) {
                alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”××¡×•×× ×™× ×‘-* ×•×œ××©×¨ ××ª ×ª× ××™ ×”×©×™××•×©');
                return;
            }
            
            // Validate phone number has exactly 10 digits
            if (!/^\d{10}$/.test(phone)) {
                alert('××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×—×™×™×‘ ×œ×”×›×™×œ ×‘×“×™×•×§ 10 ×¡×¤×¨×•×ª');
                return;
            }
            
            // Advanced validation for name (prevent injection)
            const sanitizedName = validateInput(name, 'name');
            if (sanitizedName.length < 2) {
                alert('×©× ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×');
                return;
            }
            
            // Advanced validation for phone
            const sanitizedPhone = validateInput(phone, 'phone');
            if (sanitizedPhone.length < 10) {
                alert('××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ');
                return;
            }
            
            // Store data with additional security measures
            formData.name = sanitizedName;
            formData.phone = sanitizedPhone;
            formData.consent = consent ? "×›×Ÿ" : "×œ×";
            formData.submissionStartTime = new Date().getTime();
            
            // Device fingerprinting for security
            formData.deviceInfo = {
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                userAgent: navigator.userAgent,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timestamp: new Date().toISOString()
            };
            
            // Generate CSRF token for second page
            formData.csrfToken = generateCSRFToken();
            
            // Additional hash for verification
            formData.verificationHash = generateHash(sanitizedName + sanitizedPhone);
            
            // Check for bot-like behavior (form filled too quickly)
            const now = new Date().getTime();
            const pageLoadTime = window._pageLoadTime || (now - 10000);
            if (now - pageLoadTime < 1500) {
                // Suspicious: form filled too quickly
                console.log('Bot detection: form filled too quickly');
                // Add slight delay to discourage bots
                setTimeout(() => {
                    processFirstPage();
                }, 2000);
            } else {
                processFirstPage();
            }
        }
        
        function processFirstPage() {
            // Show loading indicator
            document.getElementById('loading1').style.display = 'block';
            document.getElementById('page1Button').disabled = true;
            
            // Add CSRF token to hidden field
            document.getElementById('csrfToken').value = formData.csrfToken;
            
            // Move to page 2 after a short delay
            setTimeout(() => {
                document.getElementById('loading1').style.display = 'none';
                document.getElementById('page1Button').disabled = false;
                
                hideAllPages();
                document.getElementById('page2').classList.add('active');
                updateProgressIndicator(2);
            }, 1000);
        }
        
        function submitForm() {
            // Advanced security: Check for suspicious behaviors
            if (detectSuspiciousBehavior()) {
                console.warn('Suspicious behavior detected');
                // Add honeypot delay but still process the form
                // This slows down potential attackers without affecting legitimate users
                setTimeout(() => {
                    processSubmission();
                }, 3000);
                return;
            }
            
            processSubmission();
        }
        
        function detectSuspiciousBehavior() {
            // Check if form is being submitted by a bot
            
            // 1. Check for lack of mouse movement
            if (!window._mouseMovementDetected) {
                return true;
            }
            
            // 2. Check for extremely fast form completion
            if (formData.submissionStartTime) {
                const elapsed = new Date().getTime() - formData.submissionStartTime;
                if (elapsed < 3000) { // Less than 3 seconds to fill the form
                    return true;
                }
            }
            
            // 3. Check for hidden field tampering
            if (document.getElementById('csrfToken').value !== formData.csrfToken) {
                return true;
            }
            
            return false;
        }
        
        function processSubmission() {
            // Validate CSRF token
            const submittedToken = document.getElementById('csrfToken').value;
            if (submittedToken !== formData.csrfToken) {
                console.error('CSRF token mismatch. Potential CSRF attack.');
                alert('×©×’×™××ª ××‘×˜×—×”. ×× × ×¨×¢× ×Ÿ ××ª ×”×“×£ ×•× ×¡×” ×©× ×™×ª.');
                return;
            }
            
            // Validate second page
            const email = document.getElementById('email').value;
            const callTime = document.getElementById('callTime').value;
            const businessType = document.getElementById('businessType').value;
            const otherBusiness = document.getElementById('otherBusiness').value;
            
            if (!email || !callTime || !businessType) {
                alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”××¡×•×× ×™× ×‘-*');
                return;
            }
            
            // Validate email format with more strict validation
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailPattern.test(email)) {
                alert('× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ××™××™×™×œ ×ª×§×™× ×”');
                return;
            }
            
            if (businessType === '××—×¨' && !otherBusiness) {
                alert('× × ×œ×¤×¨×˜ ××ª ×¡×•×’ ×”×¢×¡×§ ×©×œ×š');
                return;
            }
            
            // Enhanced input validation with specific validation types
            const sanitizedEmail = validateInput(email, 'email');
            if (!sanitizedEmail) {
                alert('×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”');
                return;
            }
            
            const sanitizedBusinessType = validateInput(businessType, 'text');
            let sanitizedOtherBusiness = '';
            if (businessType === '××—×¨') {
                sanitizedOtherBusiness = validateInput(otherBusiness, 'text');
                if (!sanitizedOtherBusiness && otherBusiness) {
                    alert('×¤×™×¨×•×˜ ×¢×¡×§ ××›×™×œ ×ª×•×•×™× ×œ× ×ª×§×™× ×™×');
                    return;
                }
            }
            
            // Rate limiting with more sophisticated controls
            const lastSubmissionTime = sessionStorage.getItem('lastSubmissionTime');
            const currentTime = new Date().getTime();
            
            if (lastSubmissionTime) {
                const timeSinceLastSubmission = currentTime - parseInt(lastSubmissionTime);
                const minSubmissionInterval = 15000; // 15 seconds
                
                if (timeSinceLastSubmission < minSubmissionInterval) {
                    const waitTime = Math.ceil((minSubmissionInterval - timeSinceLastSubmission) / 1000);
                    alert(`× × ×œ×”××ª×™×Ÿ ${waitTime} ×©× ×™×•×ª ×œ×¤× ×™ ×©×œ×™×—×” ×—×•×–×¨×ª.`);
                    return;
                }
            }
            
            // Update form data with sanitized values
            formData.email = sanitizedEmail;
            formData.callTime = callTime;
            formData.businessType = sanitizedBusinessType;
            if (businessType === '××—×¨') {
                formData.otherBusinessDetails = sanitizedOtherBusiness;
            }
            
            // Remove leading zero from phone number
            if (formData.phone.startsWith('0')) {
                formData.phone = formData.phone.substring(1);
            }
            
            // Record submission time for rate limiting
            sessionStorage.setItem('lastSubmissionTime', currentTime.toString());
            
            // Show loading indicator
            document.getElementById('loading2').style.display = 'block';
            document.getElementById('page2Button').disabled = true;
            
            // Encrypt personal data before sending
            const encryptData = (data) => {
                // Simple XOR encryption with a key derived from the CSRF token
                // This is not true encryption but adds a layer of obfuscation
                const key = formData.csrfToken.split('').map(c => c.charCodeAt(0));
                return Array.from(data).map((char, i) => {
                    return String.fromCharCode(char.charCodeAt(0) ^ key[i % key.length]);
                }).join('');
            };
            
            // Enhance formData with encrypted fields
            formData.secureFields = {
                encEmail: encryptData(sanitizedEmail),
                encPhone: encryptData(formData.phone),
                checksum: generateHash(sanitizedEmail + formData.phone + currentTime)
            };
            
            // Send data to server
            sendFormData();
        }
        
        function sendFormData() {
            // Format data for Google Apps Script
            const formattedData = {
                ×©×: formData.name,
                "××¡×¤×¨ ×¤×œ××¤×•×Ÿ": formData.phone,
                ××™××™×™×œ: formData.email,
                "×–××Ÿ ×©×™×—×” ××•×¢×“×£": formData.callTime,
                "×¡×•×’ ×¢×¡×§": formData.businessType === '××—×¨' ? 
                    formData.businessType + ': ' + formData.otherBusinessDetails : 
                    formData.businessType,
                "×¡×•×’ ×˜×•×¤×¡": formData.formType,
                ×”×¡×›××”: formData.consent,
                "×ª××¨×™×š ×”×’×©×”": new Date().toLocaleString('he-IL', {
                    timeZone: 'Asia/Jerusalem'
                })
            };
            
            // Send to Google Apps Script
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formattedData),
                redirect: 'follow',
                mode: 'no-cors' // Important for cross-origin requests to Google Apps Script
            })
            .then(response => {
                console.log('Form submitted successfully');
                
                // Show the thank you page after submission
                hideAllPages();
                document.getElementById('page3').classList.add('active');
                updateProgressIndicator(3);
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                alert('××™×¨×¢×” ×©×’×™××” ×‘×©×œ×™×—×ª ×”×˜×•×¤×¡. × ×¡×” ×©× ×™×ª ×××•×—×¨ ×™×•×ª×¨.');
                document.getElementById('loading2').style.display = 'none';
                document.getElementById('page2Button').disabled = false;
            });
        }
        
        function hideAllPages() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
        }
        
        function updateProgressIndicator(step) {
            document.querySelectorAll('.step').forEach((stepElement, index) => {
                if (index + 1 === step) {
                    stepElement.className = 'step active';
                } else {
                    stepElement.className = 'step inactive';
                }
            });
        }
        
        // Show "Other" field if "Other" is selected
        document.getElementById('businessType').addEventListener('change', function() {
            const otherContainer = document.getElementById('otherBusinessContainer');
            const otherBusinessInput = document.getElementById('otherBusiness');
            
            if (this.value === '××—×¨') {
                otherContainer.style.display = 'block';
                otherBusinessInput.setAttribute('required', '');
            } else {
                otherContainer.style.display = 'none';
                otherBusinessInput.removeAttribute('required');
            }
        });
        // Implement subresource integrity checking
        function checkScriptIntegrity() {
            // Create a SHA-256 hash of our critical functions
            const criticalCode = goToSecondPage.toString() + 
                                 submitForm.toString() + 
                                 sendFormData.toString();
            
            try {
                // Create a hash of the code for integrity verification
                // This is a simplified version as we can't use crypto API directly for this
                let hash = 0;
                for (let i = 0; i < criticalCode.length; i++) {
                    const char = criticalCode.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                
                // Store the hash for future verification
                window._codeIntegrityHash = hash;
                
                // Periodically check if the code has been modified
                setInterval(function() {
                    const currentCriticalCode = goToSecondPage.toString() + 
                                              submitForm.toString() + 
                                              sendFormData.toString();
                    
                    let currentHash = 0;
                    for (let i = 0; i < currentCriticalCode.length; i++) {
                        const char = currentCriticalCode.charCodeAt(i);
                        currentHash = ((currentHash << 5) - currentHash) + char;
                        currentHash = currentHash & currentHash;
                    }
                    
                    if (currentHash !== window._codeIntegrityHash) {
                        console.error('Code integrity violation detected - possible attack');
                        alert('×–×•×”×ª×” ×‘×¢×™×™×ª ××‘×˜×—×”. ×× × ×¨×¢× ×Ÿ ××ª ×”×“×£.');
                    }
                }, 5000);
                
            } catch (e) {
                console.error('Integrity check error:', e);
            }
        }
        
        // Call integrity check on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkScriptIntegrity, 1000);
        });
</body>
</html>
